name: ğŸ”‘ Test OpenAI Key

on:
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ìš© (Actions íƒ­ì—ì„œ Run workflow ë²„íŠ¼ìœ¼ë¡œ ì‹¤í–‰)

permissions:
  contents: read

env:
  OPENAI_API_KEY: ${{ secrets.WORKFLOW_OPENAI_API_KEY }}

jobs:
  verify-openai-key:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ” Check Key Presence
        run: |
          if [ -z "$OPENAI_API_KEY" ]; then
            echo "âŒ OPENAI_API_KEY is empty (not loaded from secrets)"
            exit 1
          fi
          echo "âœ… Key is loaded. Length: ${#OPENAI_API_KEY}"

      - name: ğŸ§© Test API call to OpenAI
        run: |
          echo "ğŸ“¡ Checking OpenAI models endpoint..."
          RESPONSE=$(curl -s -w "\n%{http_code}" https://api.openai.com/v1/models \
            -H "Authorization: Bearer $OPENAI_API_KEY")

          BODY=$(echo "$RESPONSE" | head -n 1)
          STATUS=$(echo "$RESPONSE" | tail -n 1)

          echo "ğŸ”¢ HTTP Status: $STATUS"
          if [ "$STATUS" != "200" ]; then
            echo "âŒ API call failed. Here's the response:"
            echo "$BODY" | jq '.error // .'
            exit 1
          fi

          echo "âœ… API key is valid. Available models:"
          echo "$BODY" | jq '.data | map(.id)[:5]'
